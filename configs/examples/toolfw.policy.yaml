protocol_version: "2025-06-18"
# Example proxy launch with keyring auth verification:
#   toolfw proxy stdio --policy configs/examples/toolfw.policy.yaml --approval-store ./approval-store.json --auth-keys ./auth-keys.json -- mcp-gateway --mounts configs/examples/gateway.mounts.yaml --views configs/examples/gateway.views.yaml --auth-keys ./auth-keys.json
defaults:
  decision: deny
rules:
  # - id: hard_deny_env
  #   priority: 1000
  #   hard: true
  #   match:
  #     mcp_method_glob: "tools/*"
  #     tool_glob: "files.*"
  #     args:
  #       path:
  #         glob: "**/.env"
  #   decision: deny

  - match:
      mcp_method: "tools/call"
      tool: "views.query"
      args:
        view: "notes_recent"
    decision: allow

  - match:
      mcp_method: "tools/call"
      tool: "files.read"
      args:
        path_glob: "**/.env"
    decision: deny

  - match:
      mcp_method: "tools/call"
      tool: "files.write"
    decision: require_approval

  # - id: safe_files_not_env
  #   priority: 200
  #   match:
  #     mcp_method: "tools/call"
  #     tool_glob: "files.*"
  #     not:
  #       args:
  #         path:
  #           glob: "**/.env"
  #   decision: allow

  # - id: regex_example
  #   match:
  #     mcp_method: "tools/call"
  #     tool: "files.search"
  #     args:
  #       query:
  #         regex: "^[a-zA-Z0-9_\\- ]{1,64}$"
  #   decision: allow

  # - id: limit_search_per_client
  #   match:
  #     auth_verified: true
  #     mcp_method: "tools/call"
  #     tool: "files.search"
  #   limit:
  #     per_client:
  #       capacity: 10
  #       refill_per_sec: 0.2
  #   decision: allow

  # Warning example (lint): rule missing id.
  # - match:
  #     mcp_method: "tools/call"
  #     tool: "views.query"
  #   decision: deny

  - match:
      mcp_method: "tools/call"
      tool: "c2pa.inspect"
    decision: allow

  # Views-first git access (recommended):
  # - match:
  #     mcp_method: "tools/call"
  #     tool: "views.query"
  #     args:
  #       view: "repo_recent_commits"
  #   decision: allow

  # Direct git tools (tighter with auth + client_id in real policies):
  # - match:
  #     mcp_method: "tools/call"
  #     tool_glob: "git.*"
  #   decision: allow

  # - match:
  #     client_id: "alice"
  #     auth_verified: true
  #     mcp_method: "tools/call"
  #     tool: "views.query"
  #     args:
  #       view: "notes_recent"
  #   decision: allow
